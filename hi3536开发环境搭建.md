#### linux 环境搭建
##### 配置内核

 arm-hisiv600-linux-gcc编译出现提示：No such file or directory
实际就是：64位ubuntu不兼容32bit工具问题。

解决办法如下：
apt-get update
sudo apt install lib32z1-dev
apt-get install lib32z1 lib32ncurses5
apt-get install lib32stdc++6
apt-get install gcc-multilib g++-multilib 

make ARCH=arm CROSS_COMPILE=arm-hisiv400-linux- clean

make ARCH=arm CROSS_COMPILE=arm-hisiv400-linux- menuconfig

make ARCH=arm CROSS_COMPILE=arm-hisiv400-linux-  uImage 

make ARCH=arm CROSS_COMPILE=arm-hisiv400-linux- menuconfig

#### 编译 OSDRV

make OSDRV_CROSS=arm-hisiv600-linux CPU_TYPE=master PCI_MODE=master  all

##### busybox

cp osdrv/opensource/busybox/busybox-1.20.2/busybox_cfg_hi3536_400
osdrv/ opensource/busybox/busybox-1.20.2/.config

#### cmake

配置工程文件
CMakeLists.txt
配置 交叉编译器文件
hisiv400.cmake 

配置交叉编译器命令
cmake -DCMAKE_TOOLCHAIN_FILE=~./cross.cmake ..

####  配置网络
    ifconfig eth0 hw ether B0:7E:CF:2F:30:B4
    ifconfig eth0 192.168.3.144 netmask 255.255.255.0
    route add default gw 192.168.3.1

#### nfs 开发环境

Ubuntu配置成桥接模式

mount -t nfs -o nolock -o tcp -o rsize=32768,wsize=32768 192.168.3.100:/root/data/hi3536/data /mnt

umount -t nfs 192.168.3.180:/home/weizj/filesystem /mnt
####   查找关键字
 grep -rl "AO_DEV" ./

HI_MPI_VPSS_GetChnFrame
#### 海康摄像头 获取rtsp码流

rtsp://admin:hi35363536@192.168.3.145/h264/ch1/main/av_stream

主码流：
rtsp://admin:hi35363536@192.168.3.145/h264/ch1/main/av_stream
rtsp://admin:hi35363536@192.168.3.145/MPEG-4/ch1/main/av_stream
子码流：
rtsp://admin:hi35363536@192.168.3.145/mpeg4/ch1/sub/av_stream
rtsp://admin:hi35363536@192.168.3.145/h264/ch1/sub/av_stream

ffprobe -i rtsp://184.72.239.149/vod/mp4:BigBuckBunny_115k.mov
ffmpeg -i rtsp://184.72.239.149/vod/mp4:BigBuckBunny_115k.mov test.mov  
ffplay -i rtsp://admin:hi35363536@192.168.3.145/h264/ch1/main/av_stream

ffplay rtsp://184.72.239.149/vod/mp4:BigBuckBunny_115k.mov
ffmpeg -i rtsp://admin:hi35363536@192.168.3.145/h264/ch1/main/av_stream test.h264 

ffmpeg -i "1:0" -vcodec libx264 -preset ultrafast -acodec libmp3lame -ar 44100 -ac 1 -f flv rtmp://localhost:1935/rtmplive/home

start ffmpeg -f gdigrab -i desktop -vcodec libx264 -preset ultrafast -acodec libmp3lame -ar 44100 -ac 1 -f flv rtmp://localhost:1935/live/jing

ffplay rtmp://192.168.3.144/live0  -fflags nobuffer

ffplay rtmp://192.168.3.180/live  -fflags nobuffer

ffplay rtmp://192.168.3.180/liveWBC  -fflags nobuffer
ffplay rtmp://10.0.0.2/liveWBC  -fflags nobuffer
#### live555 编译
安装到指定目录

make install PREFIX=/root/lib/liblive555/

make install PREFIX=/root/data/hi3536/data/lib/liblive555/

#### openssh

prefix=/root/data/hi3536/data/lib/libzlib CC=arm-hisiv600-linux-gcc ./configure

CROSS_COMPILE=arm-hisiv600-linux- /usr/bin/perl ./Configure no-asm shared linux-armv4 --prefix=/root/data/hi3536/data/lib/libopenssl

./configure --host=arm --with-zlib-dir=/root/data/hi3536/data/lib/libzlib --with-ssl-dir=/root/data/hi3536/data/lib/libopenssl CC=arm-hisiv600-linux-gcc --prefix=/root/data/hi3536/data/lib/libopenssh --disable-etc-default-login

#### qt 交叉编译

./configure -v -prefix /root/data/hi3536/data/lib/qt-5.12.0_v400 -shared -xplatform arm-hisiv400-linux-g++ -linuxfb -qt-libpng -qt-libjpeg -make libs -opensource -make libs -sql-sqlite -qt-zlib -pch -no-opengl -nomake examples -no-sse2 -no-cups -no-glib -no-xcb -nomake tools -nomake tests 

./configure -prefix /root/data/hi3536/data/lib/qt-4.8.7_v400 -opensource  -confirm-license  -shared -embedded arm -xplatform qws/arm-hisiv400-linux-g++ -qt-sql-sqlite -qt-libjpeg -qt-zlib -qt-libpng -qt-freetype -no-qt3support -no-libtiff -no-libmng -no-opengl -no-mmx -no-sse -no-sse2 -no-3dnow -no-openssl -no-webkit -no-qvfb -no-phonon -no-nis -no-cups -no-glib -no-xcursor -no-xfixes -no-xrandr -no-xrender -no-separate-debug-info -nomake examples -nomake demos -nomake tools -nomake -nodocs -qt-mouse-pc 

./configure -v -prefix /root/data/hi3536/data/lib/qt-5.12.0_V600 -shared -xplatform arm-hisiv600-linux-g++ -linuxfb -qt-libpng -qt-libjpeg -make libs -opensource -make libs -sql-sqlite -qt-zlib -pch -no-opengl -nomake examples -no-sse2 -no-cups -no-glib -no-xcb -nomake tools -nomake tests

记得单线程编译 make 如果用make -j4 就会报错

#### 打开Qtcreater

/root/ProgramFiles/Qt-5.12.0/Tools/QtCreator/bin/qtcreator

export QT_INSTALL_PATH=/root/data/hi3536/data/lib/qt-5.12.0_V600
export LD_LIBRARY_PATH=/lib:/usr/lib:${QT_INSTALL_PATH}/lib:${LD_LIBRARY_PATH}
export QT_QWS_FONTDIR=${QT_INSTALL_PATH}/lib/fonts
export QT_QWS_DISPLAY=linuxFB:/dev/fb0

export QTDIR=/usr/local/Trolltech/Qt-4.8.2

export PATH=$QTDIR/bin:$PATH

export MANPATH=$QTDIR/man:$MANPATH

export LD_LIBRARY_PATH=$QTDIR/lib:$LD_LIBRARY_PATH

#### glibc

CC=arm-hisiv600-linux-gcc CROSS_COMPILE=arm-hisiv600-linux- ../glibc-2.17/configure --host=arm --prefix=/root/data/hi3536/data/lib/libglibc

#### 烧写

setenv serverip 192.168.3.99
setenv ipaddr 192.168.3.18
setenv ethaddr B0:7E:CF:2F:30:B3
setenv netmask 255.255.255.0
setenv gatewayip 192.168.3.1
ping 192.168.3.99

ifconfig eth0 192.168.3.18 netmask 255.255.255.0
ifconfig eth1 192.168.3.81 netmask 255.255.255.0

route add default gw 192.168.3.1

#### 关于sample_vdev

1.SAMPLE_COMM_VDEC_ThreadParam(u32VdCnt, &stVdecSend[0], &stVdecChnAttr[0], SAMPLE_1080P_H264_PATH);	
//传入文件地址

2.SAMPLE_COMM_VDEC_StartSendStream(u32VdCnt, &stVdecSend[0], &VdecThread[0]);
//取流函数，有几个通道，就开几个线程来处理,sample_vdev中定义了4个通道


3.各个线程在HI_VOID * SAMPLE_COMM_VDEC_SendStream(HI_VOID *pArgs) 中取码流
在while(1),中把每一帧送到创建的通道中去

#### sqlite 交叉编译

./configure CC=arm-hisiv400-linux-gcc --host=arm-hisiv400-linux --prefix=/root/data/hi3536/data/lib/libsqlite/

/root/data/hi3536/data/lib/libsqlite/bin/sqlite3

sqlite3 cfginfo.db

hi3536Project/db/cfginfo.db

Callback function called:
0:PARAMETER = DevID
1:VALUE = 0
2:REMARKS = NULL

#### hifb 

/root/project/hifb/sample_hifb &


配置显示相关参数与环境

#### 交叉编译ffmpeg

./configure --prefix=/root/data/hi3536/data/lib/libffmpeg/ --enable-static --enable-shared --disable-x86asm --enable-gpl --enable-nonfree --enable-cross-compile --arch=arm --target-os=linux --cross-prefix=arm-hisiv400-linux- --cc=arm-hisiv400-linux-gcc --enable-pthreads --enable-ffplay

export LD_LIBRARY_PATH=/mnt/lib/libffmpeg/lib:$LD_LIBRARY_PATH

#### nginx 编译

./configure --with-http_ssl_module --with-cc=arm-hisiv400-linux-gcc --with-cpp=arm-hisiv400-linux-cpp --with-pcre=/root/data/hi3536/data/lib/pcre-8.38 --with-openssl=/root/data/hi3536/data/lib/openssl-OpenSSL_1_1_1a --without-http_gzip_module  --add-module=../nginx-rtmp-module --without-http_upstream_zone_module

nginx当成文件服务器


#### 启动

mount -t nfs -o nolock -o tcp -o rsize=32768,wsize=32768 192.168.3.101:/root/data/hi3536/data /mnt

/mnt/hi3536Work/qtProject/hi3536Project/release/


/root/ProgramFiles/Qt-5.12.0/Tools/QtCreator/bin/qtcreator

cp -r /mnt/hi3536Work/qtProject/hi3536Project /root/project 

cd /mnt/hi3536Work/qtProject/hi3536Project/release/

#### boost

./bootstrap.sh --show-libraries

./bjam stage --layout=tagged --build-type=complete --prefix=/root/data/hi3536/data/lib/libboost --without-python -j4

./bjam --prefix=/root/data/hi3536/data/lib/libboost

#### 配置DNS
vi /etc/resolv.conf

nameserver 114.114.114.114


#### 设置时间
date -s 2019.02.25-15:31:25


#### git 服务器
git init --bare hi3536Projet.git

git clone root@192.168.3.101:/root/git/hi3536Project/hi3536Projet.git

git checkout b0362a895d39061c0bc6f05c575af47de1b3f702

git config --global user.email "yangpengbo2636@gmail.com"

git config --global  user.name "杨蓬勃"

echo "# hi3536Project" >> README.md

git init

git add README.md

touch README.md

git add ./*

git commit -a -m '心跳包头加上了4字节int型的包长'

git remote add origin https://gitee.com/ypbwithyou/hi3536Project.git

git remote add origin root@192.168.3.101:/root/git/hi3536Project/hi3536Projet.git

git remote remove origin
git push -u origin master
git push -u origin yangpengbo

git log

git reset --hard 139dcfaa558e3276b30b6b2e5cbbb9c00bbdca96 

#### json

{"PackCmd":"1","CtrlCmd":"2"}

#### valgrind 调试内存泄漏问题

 ./configure --host=arm-hisiv400-linux CC=arm-hisiv400-linux-gcc CPP=arm-hisiv400-linux-cpp CXX=arm-hisiv400-linux-g++ --prefix=/usr/local/valgrind

 ./valgrind --leak-check=full /mnt/hi3536Work/qtProject/hi3536Project/release/hi3536Project -qws

 #### pwnat

B ./pwnat -s 0.0.0.0 2022 127.0.0.1:22

A ./pwnat -c 127.0.0.1 3022 1.83.127.27 2022 127.0.0.1 22

#### ntp交叉编译
./configure --prefix=/root/data/hi3536/data/lib/libntp --exec-prefix=/usr/local/ntp 
--host=arm-hisiv400-linux CC=arm-hisiv400-linux-gcc --with-yielding-select=yes --enable-static --with-crypto --with-openssl-incdir=/root/data/hi3536/data/lib/openssl-OpenSSL_1_1_1a/include/openssl

#### nginx 文件服务器

server {
    listen 80;
    server_name 127.0.0.1;
    charset utf-8;
 
    root /;

    location / {
      autoindex on; 
      autoindex_exact_size on;
      autoindex_localtime on; 
    }
  }

#### 服务器密码
39.98.234.58  
root
hanHaiypb93

#### n2n 测试

git clone https://github.com/ntop/n2n.git

cd n2n

git checkout 2.4-stable

mkdir build

cmake ..

make 

./supernode -l 8118 -v

<!-- ./edge -d test01 -c test -k key -a 10.0.0.1 -l 39.98.234.58:8118 >/dev/null & -->

<!-- ./edge -d test02 -c test -k key -a 10.0.0.2 -l 39.98.234.58:8118 >/dev/null & -->

./edge -d A -c mynetwork -k encryptme -u 99 -g 99 -m 3C:A0:12:34:56:78 -a 10.0.0.1 -l 39.98.234.58:8118

./edge -d B -c mynetwork -k encryptme -u 99 -g 99 -m 3C:A0:12:34:56:79 -a 10.0.0.2 -l 39.98.234.58:8118

#### 交叉编译openssl

./config no-asm shared --prefix=/root/data/hi3536/data/lib/libopenssl --cross-compile-prefix=arm-hisiv400-linux-

#### 交叉编译n2n


link_directories(directory1 directory2 ...) #缺什么补什么

cmake -DCMAKE_TOOLCHAIN_FILE=~./cross.cmake  -DOPENSSL_ROOT_DIR=/root/data/hi3536/data/lib/libopenssl -DOPENSSL_CRYPTO_LIBRARY=/root/data/hi3536/data/lib/libopenssl/lib ..
       
                       

